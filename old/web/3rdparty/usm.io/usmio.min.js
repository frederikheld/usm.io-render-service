!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.usm=e():t.usm=e()}(window,function(){return function(t){var e={};function a(s){if(e[s])return e[s].exports;var n=e[s]={i:s,l:!1,exports:{}};return t[s].call(n.exports,n,n.exports,a),n.l=!0,n.exports}return a.m=t,a.c=e,a.d=function(t,e,s){a.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},a.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},a.t=function(t,e){if(1&e&&(t=a(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(a.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)a.d(s,n,function(e){return t[e]}.bind(null,n));return s},a.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return a.d(e,"a",e),e},a.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},a.p="",a(a.s=0)}([function(t,e,a){"use strict";function s(){}function n(t){this.jsonRoadmap=t}function r(t){this.jsonCard=t}function o(t){this.jsonRelease=t}function i(t,e){this.jsonStep=t,this.jsonRoadmap=e}a.r(e),s.prototype.render=function(t,e,a=0){var s=t.append("g").attrs({class:"timeline",transform:"translate(0, "+a+")"});return s.append("polygon").attrs({points:[[0,0],[e-20,0],[e-20,-4],[e,2],[e-20,8],[e-20,4],[0,4]]}).styles({fill:"#000"}),s},n.prototype.render=function(t,e,a=0){var s=t.append("g").attrs({class:"roadmap",transform:"translate(0,"+a+")"});this.jsonRoadmap.release.forEach(function(t,a){var n=70*t.maxCardsBefore+20*t.releasesBefore+70*t.maxCards,r=s.append("g").attrs({class:"release",transform:"translate(0,"+n+")"});r.append("rect").attrs({x:0,y:0,width:e,height:1}),r.append("text").text(t.name._text+" ("+t.maxCards+")").attrs({x:0,y:-5,width:e,height:1})},this)},r.prototype.render=function(t,e,a=0,s=0){var n=t.append("g").attrs({class:"card",transform:"translate("+a+","+s+")"});n.append("rect").attrs({x:0,y:0,width:100,height:60}).styles({stroke:"black",fill:"white"});var r=new d3.textwrap;r.bounds({width:100,height:60}).padding(10);n.append("text").text(this.jsonCard.title._text).attrs({x:50,y:30}).styles({"alignment-baseline":"middle","text-anchor":"middle"}).call(r);n.on("click",()=>{(e.detailsContainer.html(""),n.classed("active"))?n.classed("active",!1):(d3.selectAll("#usm .card").classed("active",!1),n.classed("active",!0),this.jsonCard.description._text?this.jsonCard.description._text.split("\n").forEach(function(t,a){e.detailsContainer.append("p").text(t)}):e.detailsContainer.append("p").text("<no description>"))})},o.prototype.render=function(t,e,a=0){var s=t.append("g").attrs({class:"release",transform:"translate(0, "+a+")"});this.jsonRelease.card.forEach(function(t,a){var n=70*a;new r(t).render(s,e,0,n)})},i.prototype.render=function(t,e,a=0){var s=t.append("g").attrs({class:"step",transform:"translate("+a+", 0)"});new r(this.jsonStep).render(s,e);new d(this.jsonStep.body,this.jsonRoadmap).render(s,e,85)};var d=function(t,e){this.jsonStepBody=t,this.jsonRoadmap=e};function c(t,e){this.jsonActivity=t,this.jsonRoadmap=e}d.prototype.render=function(t,e,a=0){var s=t.append("g").attrs({class:"stepbody",transform:"translate(0, "+a+")"});this.jsonStepBody.release.forEach(function(t,a){var n=t._attributes.id,r=function(t,e){var a=void 0;return t.release.forEach(function(t,s){t.id._text==e&&(a=s)}),a}(this.jsonRoadmap,n),i=70*this.jsonRoadmap.release[r].maxCardsBefore;i+=20*this.jsonRoadmap.release[r].releasesBefore,new o(t).render(s,e,i)},this)},c.prototype.render=function(t,e,a=0){var s=t.append("g").attrs({class:"activity",transform:"translate("+a+", 0)"});new r(this.jsonActivity).render(s,e);new p(this.jsonActivity.body,this.jsonRoadmap).render(s,e,70)};var p=function(t,e){this.jsonActivityBody=t,this.jsonRoadmap=e};function h(t,e){this.jsonBackbone=t,this.jsonRoadmap=e}function u(t){this.jsonData=t,this.timeline=new s,this.backbone=new h(this.jsonData.usm.backbone,this.jsonData.usm.roadmap),this.roadmap=new n(this.jsonData.usm.roadmap),this.optimizeDataStructure(),this.generateMetaData()}p.prototype.render=function(t,e,a=0){var s=t.append("g").attrs({class:"activitybody",transform:"translate(0, "+a+")"});this.jsonActivityBody.step.forEach(function(t,a){var n=110*a;new i(t,this.jsonRoadmap).render(s,e,n)},this)},h.prototype.render=function(t,e){var a=t.append("g").attrs({class:"backbone"});this.jsonBackbone.activity.forEach(function(t,s){var n=110*t.numberOfCardsBefore+20*s;new c(t,this.jsonRoadmap).render(a,e,n)},this)},a.d(e,"USM",function(){return u}),u.prototype.render=function(t,e,a,s=!1){console.log(a);var n=t.append("svg").attrs({xmlns:"http://www.w3.org/2000/svg",class:"usm",x:0,y:0}),r=n.append("g").attrs({class:"canvas",transform:"translate("+a.marginLeft+","+a.marginTop+")"});this.backbone.render(r,e),a.canvasWidth=r.node().getBoundingClientRect().width,a.canvasHeight=r.node().getBoundingClientRect().height,this.timeline.render(r,a.canvasWidth,140),this.roadmap.render(r,a.canvasWidth,160),a.canvasWidth=r.node().getBoundingClientRect().width,a.canvasHeight=r.node().getBoundingClientRect().height,this.renderDebug(r,a,s);var o=a.canvasWidth+a.marginRight+a.marginLeft,i=a.canvasHeight+a.marginTop+a.marginBottom;if(void 0!==a.scaleToWidth)var d=a.scaleToWidth;else d=a.canvasWidth;if(void 0!==a.scaleToHeight)var c=a.scaleToHeight;else c=a.canvasHeight;n.attrs({width:d+"px",height:c+"px",viewBox:"0 0 "+o+" "+i,preserveAspectRatio:"xMinYMin meet"})},u.prototype.renderDebug=function(t,e,a=!1){a&&function(t,e){t.append("rect").attrs({x:0,y:0,width:e.canvasWidth,height:e.canvasHeight}).styles({stroke:"#f00","stroke-width":1,"stroke-dasharray":"10,10",fill:"none"})}(t.append("g").attrs({class:"debug"}),e)},u.prototype.optimizeDataStructure=function(){this.jsonData.usm.backbone.activity.forEach(function(t,e){if(!Array.isArray(t.body.step)){var a=this.jsonData.usm.backbone.activity[e].body.step;this.jsonData.usm.backbone.activity[e].body.step=[],this.jsonData.usm.backbone.activity[e].body.step[0]=a}t.body.step.forEach(function(t,a){if(!Array.isArray(t.body.release)){var s=this.jsonData.usm.backbone.activity[e].body.step[a].body.release;this.jsonData.usm.backbone.activity[e].body.step[a].body.release=[],this.jsonData.usm.backbone.activity[e].body.step[a].body.release[0]=s}t.body.release.forEach(function(t,s){if(!Array.isArray(t.card)){var n=this.jsonData.usm.backbone.activity[e].body.step[a].body.release[s].card;this.jsonData.usm.backbone.activity[e].body.step[a].body.release[s].card=[],this.jsonData.usm.backbone.activity[e].body.step[a].body.release[s].card[0]=n}},this)},this)},this)},u.prototype.generateMetaData=function(){this.jsonData.usm.roadmap.release.forEach(function(t,e){this.jsonData.usm.roadmap.release[e].maxCards=0,this.jsonData.usm.roadmap.release[e].maxCardsBefore=0,this.jsonData.usm.roadmap.release[e].releasesBefore=0},this),this.jsonData.usm.backbone.activity.forEach(function(t,e){this.jsonData.usm.backbone.activity[e].numberOfCards=t.body.step.length,this.jsonData.usm.backbone.activity[e].numberOfCardsBefore=0},this),this.jsonData.usm.backbone.activity.forEach(function(t,e){for(var a=0;a<e;a++)this.jsonData.usm.backbone.activity[e].numberOfCardsBefore+=this.jsonData.usm.backbone.activity[a].numberOfCards;t.body.step.forEach(function(t,e){var a={};t.body.release.forEach(function(t,e){var s=t._attributes.id;t.card.forEach(function(e,n){"_attributes"in t&&(s in a?a[s]+=1:a[s]=1)})}),this.jsonData.usm.roadmap.release.forEach(function(t,e){a[t.id._text]>this.jsonData.usm.roadmap.release[e].maxCards&&(this.jsonData.usm.roadmap.release[e].maxCards=a[t.id._text])},this)},this)},this),this.jsonData.usm.roadmap.release.forEach(function(t,e){for(var a=0;a<e;a++)this.jsonData.usm.roadmap.release[e].maxCardsBefore+=this.jsonData.usm.roadmap.release[a].maxCards,this.jsonData.usm.roadmap.release[e].releasesBefore+=1},this)}}])});