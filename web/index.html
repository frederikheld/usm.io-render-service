<!doctype html>
<html>

<head>
    <meta charset="utf-8">
    <title>User Story Map</title>
    <script type="text/javascript" src="lib/jquery/jquery-3.3.1.js"></script>
    <script type="text/javascript" src="lib/d3/d3.v5.min.js"></script>
    <script type="text/javascript" src="lib/d3/d3-selection-multi.v1.min.js"></script>
    <script type="text/javascript" src="lib/d3/d3-polygon.v1.min.js"></script>
    <style type="text/css">
        html,
        body {
            margin: 0;
            padding: 0;
        }

        #usm {
            position: absolute;
            background: lightgrey;
            width: 100%;
            height: 100%;
            overflow: hidden;
            /*  "overflow: hidden" is a fix for the little gap
                at the bottom, that appears in combination with
                "height: 100%" on the svg element.
            */
        }

        #usm svg {
            width: 100%;
            height: 100%;
            background: lightblue
        }
    </style>

    <script type="text/javascript">
        var USM = function (domSelector, margins) {

            // store params:

            this.domSelector = domSelector
            this.margins = margins


            // create svg element as canvas:

            this.canvas = d3.select(this.domSelector)
                .append("svg")
                .attrs({
                    xmlns: "http://www.w3.org/2000/svg",
                })


            // store canvas dimensions:

            this.canvasWidth = parseInt(this.canvas.style("width"))
            this.canvasHeight = parseInt(this.canvas.style("height"))


            // render the whole thing:

            this.render(true)
        }

        USM.prototype.render = function (debug = false) {

            this.renderTimeline()
            this.renderBackbone()

            if (debug) {
                this.renderBoundingBox()
            }
        }

        USM.prototype.renderTimeline = function () {

            var offsetX = this.margins.left
            var offsetY = 100

            var timeline = this.canvas
                .append("polygon")
                .attrs({
                    points: [
                        [0, 0],
                        [this.canvasWidth - this.margins.left - this.margins.right - 20, 0],
                        [this.canvasWidth - this.margins.left - this.margins.right - 20, -4],
                        [this.canvasWidth - this.margins.left - this.margins.right, 2],
                        [this.canvasWidth - this.margins.left - this.margins.right - 20, 8],
                        [this.canvasWidth - this.margins.left - this.margins.right - 20, 4],
                        [0, 4]
                    ],
                    transform: "translate(" + offsetX + ", " + offsetY + ")"
                })
                .styles({
                    "fill": "#666"
                })

        }

        USM.prototype.renderBoundingBox = function () {
            var boundingBox = this.canvas
                .append("rect")
                .attrs({
                    x: this.margins.left,
                    y: this.margins.top,
                    width: this.canvasWidth - this.margins.left - this.margins.right,
                    height: this.canvasHeight - this.margins.top - this.margins.bottom,
                })
                .styles({
                    "stroke": "#f00",
                    "stroke-width": 1,
                    "stroke-dasharray": "10,10",
                    "fill": "none"
                })
        }
    </script>

    <script type="text/javascript">
        const apiEndpoint = "http://localhost:8080"
        const margins = {
            top: 40,
            right: 20,
            bottom: 40,
            left: 20
        }

        $(document).ready(function () {
            $.ajax({
                url: apiEndpoint + "/data"
            }).then(function (data) {

                console.log("data:", data)

                var usm = new USM("#usm", margins)

            })
        })
    </script>

</head>

<body>
    <div id="usm"></div>
</body>

</html>