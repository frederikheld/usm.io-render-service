<!doctype html>
<html>

<head>
    <meta charset="utf-8">
    <title>User Story Map</title>
    <script src="lib/d3/d3.v5.min.js"></script>
    <script src="lib/d3/d3-selection-multi.v1.min.js"></script>
    <script src="lib/d3/d3-polygon.v1.min.js"></script>
    <script src="lib/d3/d3-textwrap.min.js"></script>
    <style type="text/css">
        html,
        body {
            margin: 0;
            padding: 0;
        }

        #usm {
            position: absolute;
            background: lightcoral;
            width: 80%;
            height: 100%;
            overflow: hidden;
            /*  "overflow: hidden" is a fix for the little gap
                at the bottom, that appears in combination with
                "height: 100%" on the svg element.
            */
        }

        #usm svg {
            width: 100%;
            height: 100%;
            overflow: scroll;
            background: lightblue;
        }

        #usm svg g.step:nth-child(1) g.card rect {
            fill: #0f6 !important;
        }

        #usm svg g.step:nth-child(2) g.card rect {
            fill: #0fa !important;
        }

        #usm svg g.step:nth-child(3) g.card rect {
            fill: #0ff !important;
        }

        #usm svg g.step:nth-child(4) g.card rect {
            fill: #0cf !important;
        }

        #usm svg g.step:nth-child(5) g.card rect {
            fill: #09f !important;
        }
    </style>

    <script type="module">
        import USM from './usm.io/usm.js'

        const apiEndpoint = "http://localhost:8080"
        const margins = {
            top: 40,
            right: 20,
            bottom: 40,
            left: 20
        }

        document.addEventListener("DOMContentLoaded", function (event) {

            var url = apiEndpoint + "/data"

            d3.json(url)
                .then((result) => {

                    var dimensions = {
                        width: parseInt(d3.select("#usm").style("width")),
                        height: 1000, // TODO: Set height according to svg contents
                        marginTop: 40,
                        marginRight: 20,
                        marginBottom: 40,
                        marginLeft: 20
                    }

                    var usm = new USM(result.data)
                    usm.render(d3.select("#usm"), dimensions, false)

                })
                .catch((error) => {
                    console.error("Error:", error)
                })

        })
    </script>

</head>

<body>
    <div id="usm"></div>
</body>

</html>